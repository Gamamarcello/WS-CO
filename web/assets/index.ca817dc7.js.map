{"version":3,"file":"index.ca817dc7.js","sources":["../../vite/modulepreload-polyfill","../../main.js"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","import \"./style.css\";\nimport \"ol/ol.css\";\nimport Map from \"ol/Map\";\nimport View from \"ol/View\";\nimport { Tile as TileLayer, Vector as VectorLayer } from \"ol/layer\";\nimport { XYZ as XYZ, Vector as VectorSource } from \"ol/source\";\nimport {Attribution, defaults as defaultControls }from \"ol/control\";\nimport { Icon, Style } from \"ol/style\";\nimport GeoJSON from \"ol/format/GeoJSON\";\n\n// import { useGeographic } from \"ol/proj\";\n// useGeographic();\n\nimport $ from \"jquery\";\nwindow.jQuery = window.$ = $;\n\nconst centerMap = [-75.573553, 6.2443382];\nconst key =\n  \"pk.eyJ1IjoiZWxwYmF0aXN0YSIsImEiOiJja3gyZHl5OXYxbm5yMnFxOTFtZWhqbWlhIn0.bbHJjnHrt_d9iqu4hBZgyw\";\nconst attribution = new Attribution({\n  collapsible: false,\n});\n\nconst icon = new Style({\n  image: new Icon({\n    anchor: [0.5, 31],\n    anchorXUnits: \"fraction\",\n    anchorYUnits: \"pixels\",\n    src: \"../img/map-marker-2-32.png\",\n  }),\n});\n\n// const scaleBar = new ScaleLine({\n//   units: \"metric\",\n//   bar: true,\n//   steps: 4,\n//   text: true,\n//   minWidth: 140,\n// });\n\nconst baseMap = new TileLayer({\n  source: new XYZ({\n    attributions:\n      '© <a href=\"https://www.mapbox.com/map-feedback/\">Mapbox</a> ' +\n      '© <a href=\"https://www.openstreetmap.org/copyright\">' +\n      \"OpenStreetMap contributors</a>\",\n    url:\n      \"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=\" +\n      key,\n  }),\n});\n\nconst addresses = new VectorLayer({\n  style: icon,\n});\n\nconst map = new Map({\n  controls: defaultControls({ attribution: false }).extend([attribution]),\n  target: \"map\",\n  layers: [baseMap, addresses],\n  view: new View({\n    projection: \"EPSG:4326\",\n    center: centerMap,\n    zoom: 15,\n  }),\n});\n\n// map.addControl(scaleBar);\n\nconst searchBounded = (term, boundingBox) => {\n  $.ajax({\n    url: \"http://api.addressforall.org/test/_sql/rpc/search_bounded\",\n    type: \"POST\",\n    processData: false,\n    contentType: \"application/json\",\n    cache: true,\n    jsonp: false,\n    data: JSON.stringify({\n      _q: term,\n      viewbox: boundingBox,\n      // lim: null,\n    }),\n    dataType: \"json\",\n    crossDomain: true,\n    success: function (data) {\n      // clear map\n      addresses.setSource(null);\n      // plot search results\n      addresses.setSource(\n        new VectorSource({\n          features: new GeoJSON().readFeatures(data),\n        })\n      );\n      let result = data.features.map(\n        (feature) =>\n          '<li class=\"list-group-item d-flex justify-content-between align-items-start\">' +\n          '<div class=\"ms-2 me-auto\">' +\n          '<div class=\"fw-bold\">' +\n          feature.properties.address +\n          \"</div>\" +\n          '<div class=\"fw-lighter\">' +\n          feature.properties.display_name +\n          \" \" +\n          feature.properties.barrio +\n          // \" \" +\n          // feature.properties.comuna +\n          \"</div>\" +\n          \"</div>\" +\n          '<span class=\"badge bg-info bg-opacity-85 rounded-pill\">' +\n          Math.round(feature.properties.similarity * 100) +\n          \"%\" +\n          \"</span>\" +\n          \"</li>\"\n      );\n      // show results\n      $(\"#afo-results\").show();\n      // clear the list\n      $(\"#afo-results\").children(\"ul\").empty();\n      // populate the list\n      $(\"#afo-results\").children(\"ul\").append(result);\n      // $(\"#afo-results\").focus();\n      //  response(\n      //    data.features.map((feature) => feature.properties.display_name)\n      //  );\n      // console.log(data.features.map((feature) => feature.properties.display_name));\n      // console.log(\n      //   data.features.map((feature) => feature.properties.similarity)\n      // );\n    },\n  });\n};\n\nconst search = (e) => {\n  let searchBox = $(e.target);\n  e.stopPropagation();\n  clearTimeout(searchBox.data(\"timeout\"));\n  searchBox.data(\n    \"timeout\",\n    setTimeout(function () {\n      let term = searchBox.val();\n      if (term.length >= 3) {\n        searchBounded(term, map.getView().calculateExtent(map.getSize()));\n      }\n    }, 200)\n  );\n};\n\n$(\"#search\").on(\"keyup\", function (e) {\n  search(e);\n});\n"],"names":["defaultControls"],"mappings":"iHAAA,KAAM,GAAI,UAAoB,CAC1B,KAAM,GAAU,SAAS,cAAc,QAAQ,QAC/C,GAAI,GAAW,EAAQ,UAAY,EAAQ,SAAS,iBAChD,OAEJ,SAAW,KAAQ,UAAS,iBAAiB,6BACzC,EAAe,GAEnB,GAAI,kBAAiB,AAAC,GAAc,CAChC,SAAW,KAAY,GACnB,GAAI,EAAS,OAAS,YAGtB,SAAW,KAAQ,GAAS,WACxB,AAAI,EAAK,UAAY,QAAU,EAAK,MAAQ,iBACxC,EAAe,KAG5B,QAAQ,SAAU,CAAE,UAAW,GAAM,QAAS,KACjD,WAAsB,EAAQ,CAC1B,KAAM,GAAY,GAClB,MAAI,GAAO,WACP,GAAU,UAAY,EAAO,WAC7B,EAAO,gBACP,GAAU,eAAiB,EAAO,gBACtC,AAAI,EAAO,cAAgB,kBACvB,EAAU,YAAc,UACvB,AAAI,EAAO,cAAgB,YAC5B,EAAU,YAAc,OAExB,EAAU,YAAc,cACrB,EAEX,WAAwB,EAAM,CAC1B,GAAI,EAAK,GAEL,OACJ,EAAK,GAAK,GAEV,KAAM,GAAY,EAAa,GAC/B,MAAM,EAAK,KAAM,KAEvB,AAAoB,IC5BtB,OAAO,OAAS,OAAO,EAAI,EAE3B,KAAM,GAAY,CAAC,WAAY,WACzB,EACJ,gGACI,EAAc,GAAI,GAAY,CAClC,YAAa,KAGT,EAAO,GAAI,GAAM,CACrB,MAAO,GAAI,GAAK,CACd,OAAQ,CAAC,GAAK,IACd,aAAc,WACd,aAAc,SACd,IAAK,iCAYH,EAAU,GAAI,GAAU,CAC5B,OAAQ,GAAI,GAAI,CACd,aACE,uJAGF,IACE,sFACA,MAIA,EAAY,GAAI,GAAY,CAChC,MAAO,IAGH,EAAM,GAAI,GAAI,CAClB,SAAUA,EAAgB,CAAE,YAAa,KAAS,OAAO,CAAC,IAC1D,OAAQ,MACR,OAAQ,CAAC,EAAS,GAClB,KAAM,GAAI,GAAK,CACb,WAAY,YACZ,OAAQ,EACR,KAAM,OAMJ,EAAgB,CAAC,EAAM,IAAgB,CAC3C,EAAE,KAAK,CACL,IAAK,4DACL,KAAM,OACN,YAAa,GACb,YAAa,mBACb,MAAO,GACP,MAAO,GACP,KAAM,KAAK,UAAU,CACnB,GAAI,EACJ,QAAS,IAGX,SAAU,OACV,YAAa,GACb,QAAS,SAAU,EAAM,CAEvB,EAAU,UAAU,MAEpB,EAAU,UACR,GAAI,GAAa,CACf,SAAU,GAAI,KAAU,aAAa,MAGzC,GAAI,GAAS,EAAK,SAAS,IACzB,AAAC,GACC,+HAGA,EAAQ,WAAW,QACnB,iCAEA,EAAQ,WAAW,aACnB,IACA,EAAQ,WAAW,OAGnB,sEAGA,KAAK,MAAM,EAAQ,WAAW,WAAa,KAC3C,iBAKJ,EAAE,gBAAgB,OAElB,EAAE,gBAAgB,SAAS,MAAM,QAEjC,EAAE,gBAAgB,SAAS,MAAM,OAAO,OAaxC,EAAS,AAAC,GAAM,CACpB,GAAI,GAAY,EAAE,EAAE,QACpB,EAAE,kBACF,aAAa,EAAU,KAAK,YAC5B,EAAU,KACR,UACA,WAAW,UAAY,CACrB,GAAI,GAAO,EAAU,MACrB,AAAI,EAAK,QAAU,GACjB,EAAc,EAAM,EAAI,UAAU,gBAAgB,EAAI,aAEvD,OAIP,EAAE,WAAW,GAAG,QAAS,SAAU,EAAG,CACpC,EAAO"}